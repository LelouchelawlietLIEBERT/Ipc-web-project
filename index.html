<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chaos Chat Ultra Simple</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    background:#0e0e0e;
    color:white;
    font-family:system-ui,sans-serif;
    margin:0;
    padding:0;
  }


  .container {
    padding:20px;
    max-width:800px;
    margin:auto;
  }


  input, button {
    width:100%;
    padding:14px;
    font-size:16px;
    border-radius:10px;
    border:none;
    margin-top:10px;
  }


  button { background:#6d4aff; color:white; font-weight:600; }


  .message {
    padding:12px;
    border-radius:10px;
    background:#222;
    margin:8px 0;
    word-break:break-word;
  }


  .me {
    background:#6d4aff;
    text-align:right;
  }


  .meta {
    font-size:12px;
    opacity:0.7;
  }


  #messages {
    margin-top:20px;
  }
</style>
</head>


<body>


<!-- JOIN PAGE -->
<div id="joinPage" class="container">
  <h1>Chaos Chat ðŸ’€</h1>
  <input id="usernameInput" placeholder="Enter username">
  <input id="roomInput" placeholder="Room name">
  <button id="joinBtn">Enter Chat</button>
</div>


<!-- CHAT PAGE -->
<div id="chatPage" class="container" style="display:none;">
  <h2 id="roomTitle"></h2>
  <div id="messages"></div>


  <input id="textInput" placeholder="Type messageâ€¦">
  <button id="sendBtn">Send</button>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc,
    query, orderBy, onSnapshot, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";


  const firebaseConfig = {
    apiKey: "AIzaSyCbUUOrC8mNhOr2hXNZzP9nE68BCddH70A",
    authDomain: "bullshit-cc1c4.firebaseapp.com",
    projectId: "bullshit-cc1c4"
  };


  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);


  const joinPage = document.getElementById("joinPage");
  const chatPage = document.getElementById("chatPage");
  const usernameInput = document.getElementById("usernameInput");
  const roomInput = document.getElementById("roomInput");
  const joinBtn = document.getElementById("joinBtn");
  const roomTitle = document.getElementById("roomTitle");
  const messagesEl = document.getElementById("messages");
  const textInput = document.getElementById("textInput");
  const sendBtn = document.getElementById("sendBtn");


  let username=null;
  let room=null;
  let unsub=null;


  joinBtn.onclick = () => {
    username = usernameInput.value.trim();
    room = roomInput.value.trim().toLowerCase();
    if (!username || !room) return alert("enter username + room");


    joinPage.style.display="none";
    chatPage.style.display="block";
    roomTitle.textContent = `Room: ${room}`;


    startListener();
  };


  sendBtn.onclick = async () => {
    const text = textInput.value.trim();
    if (!text) return;
    textInput.value = "";


    await addDoc(collection(db,"rooms",room,"messages"),{
      from:username,
      text,
      time:serverTimestamp()
    });
  };


  function startListener() {
    if (unsub) unsub();


    const q = query(
      collection(db,"rooms",room,"messages"),
      orderBy("time","asc")
    );


    unsub = onSnapshot(q, snapshot => {
      snapshot.docChanges().forEach(change => {
        if (change.type==="added") renderMessage(change.doc.data());
      });


      window.scrollTo(0,document.body.scrollHeight);
    });
  }


  function renderMessage(m) {
    const div=document.createElement("div");
    div.classList.add("message");
    if (m.from===username) div.classList.add("me");


    div.innerHTML = `<div class="meta">${m.from}</div>${m.text}`;
    messagesEl.appendChild(div);
  }
</script>


</body>
</html>
